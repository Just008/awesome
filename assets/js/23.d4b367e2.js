(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{190:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p",[t._v("本文的大多数内容来自: "),s("a",{attrs:{href:"https://lufficc.com/blog/configure-nginx-as-a-web-server",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置Web服务器"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("阅读之前，建议先阅读"),s("router-link",{attrs:{to:"./base-1.html"}},[t._v("初识 Nginx")]),t._v("。 之后，我们来了解一下 Nginx 配置。")],1),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),s("p",[t._v("上述配置，如果不写端口号，默认使用80端口，如果不写 IP ，则监听本机所有 IP。")]),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._m(20),t._v(" "),t._m(21),t._m(22),t._v(" "),t._m(23),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._m(36),t._v(" "),t._m(37),t._m(38),t._v(" "),s("p",[t._v("具体的搜索匹配流程如下：")]),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._m(42),t._v(" "),s("p",[s("code",[t._v("location")]),t._v(" 也定义了如何处理匹配的请求："),s("strong",[t._v("返回静态文件")]),t._v(" 或者 "),s("strong",[t._v("交给代理服务器处理")]),t._v("。下面的例子中，第一个 "),s("code",[t._v("location")]),t._v(" 返回 "),s("code",[t._v("/data")]),t._v(" 目录中的静态文件，第二个 "),s("code",[t._v("location")]),t._v(" 则将请求传递给 "),s("a",{attrs:{href:"https://laragh.top/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://laragh.top"),s("OutboundLink")],1),t._v(" 域名的服务器处理：")]),t._v(" "),t._m(43),t._m(44),t._v(" "),t._m(45),t._v(" "),s("p",[t._v("比如我把 "),s("code",[t._v("proxy_pass")]),t._v(" 设置为 "),s("code",[t._v("https://www.baidu.com/")]),t._v("，那么访问 "),s("a",{attrs:{href:"http://search.laragh.top/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://search.laragh.top/"),s("OutboundLink")],1),t._v(" 将得到百度首页一样的响应（页面）（感兴趣的童鞋可以自己试一试搜索功能，和百度没差别呢）：")]),t._v(" "),t._m(46),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._v(" "),s("p",[t._v("一些常用的变量如下：")]),t._v(" "),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._m(56),t._v(" "),t._m(57),t._m(58),t._v(" "),t._m(59),s("p",[t._v("或者：")]),t._v(" "),t._m(60),t._m(61),t._v(" "),t._m(62),t._v(" "),t._m(63),t._m(64),t._v(" "),t._m(65),t._v(" "),t._m(66),t._m(67),t._v(" "),t._m(68),t._v(" "),t._m(69),t._m(70),t._v(" "),t._m(71),t._v(" "),t._m(72),t._v(" "),t._m(73),t._m(74),t._v(" "),t._m(75),t._v(" "),t._m(76),t._v(" "),t._m(77),t._v(" "),t._m(78),t._v(" "),t._m(79),t._v(" "),t._m(80),t._v(" "),t._m(81),t._v(" "),s("p",[t._v("例如请求：")]),t._v(" "),t._m(82),t._v(" "),t._m(83),t._v(" "),t._m(84),t._v(" "),t._m(85),t._v(" "),t._m(86),t._v(" "),t._m(87),t._v(" "),t._m(88),t._v(" "),t._m(89),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.nginx.com/resources/admin-guide/nginx-web-server/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.nginx.com/resources/admin-guide/nginx-web-server/"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"http://seanlook.com/2015/05/17/nginx-location-rewrite/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://seanlook.com/2015/05/17/nginx-location-rewrite/"),s("OutboundLink")],1)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"配置-web-服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-web-服务器"}},[this._v("#")]),this._v(" 配置 Web 服务器")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("抽象来说，将 Nginx 配置为 Web 服务器就是定义"),e("strong",[this._v("处理哪些 URLS")]),this._v(" 和"),e("strong",[this._v("如何处理这些URLS 对应的请求")]),this._v("。具体来说，就是定义一些虚拟服务器（Virtual Servers），控制具有特定 IP 和域名的请求。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("更具体的来说， Nginx 通过定义一系列 "),s("code",[t._v("location")]),t._v(" 来控制对 "),s("code",[t._v("URIS")]),t._v(" 的选择。每一个 "),s("code",[t._v("location")]),t._v(" 定义了对映射到自己的请求的处理场景："),s("strong",[t._v("返回一个文件")]),t._v("或者"),s("strong",[t._v("代理请求")]),t._v("，或者根据不同的错误代码返回不同的错误页面。另外，根据 "),s("code",[t._v("URI")]),t._v(" 的不同，请求也可以被"),s("strong",[t._v("重定向")]),t._v("到其它 "),s("code",[t._v("server")]),t._v(" 或者 "),s("code",[t._v("location")]),t._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"设置虚拟服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置虚拟服务器"}},[this._v("#")]),this._v(" 设置虚拟服务器")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"listen"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#listen"}},[this._v("#")]),this._v(" "),e("code",[this._v("listen")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Nginx 配置文件至少包含一个 "),e("code",[this._v("server")]),this._v(" 命令 ，用来定义虚拟服务器。当请求到来时， Nginx 会首先选择一个虚拟服务器来处理该请求。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("虚拟服务器定义在 "),e("code",[this._v("http")]),this._v(" 上下文中的 "),e("code",[this._v("server")]),this._v(" 中：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("http "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Server configuration")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[e("em",[this._v("注意： http 中可以定义多个 server")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("server")]),this._v(" 配置块使用 "),e("code",[this._v("listen")]),this._v(" 命令监听本机 IP 和端口号（包括 Unix domain socket and path），支持 IPv4、IPv6，IPv6地址需要用方括号括起来：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),t._v(".0.1:8080"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# IPv4地址，8080端口")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# listen [2001:3CA1:10F:1A:121B:0:0:10]:80;   # IPv6地址，80端口")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# listen [::]:80;  # 听本机的所有IPv4与IPv6地址，80端口")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The rest of server configuration")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"server-name"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#server-name"}},[this._v("#")]),this._v(" "),e("code",[this._v("server_name")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果多个 "),e("code",[this._v("server")]),this._v(" 的 "),e("code",[this._v("listen")]),this._v(" IP 和端口号一模一样， Nginx 通过请求头中的 Host：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"http://md.laragh.top/vuepress/nginx/nginx-base-1.png",alt:"img"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("与 "),e("code",[this._v("server_name")]),this._v(" 定义的主机名进行比较，来选择合适的虚拟服务器处理请求：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name laragh.top  www.laragh.top"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("server_name")]),this._v(" 的参数可以为：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("p",[t._v("完整的主机名，如："),s("code",[t._v("api.laragh.top")]),t._v(" 。")])]),t._v(" "),s("li",[s("p",[t._v("含有通配符（含有 "),s("code",[t._v("*")]),t._v("），如："),s("code",[t._v("*.laragh.top")]),t._v(" 或 "),s("code",[t._v("api.*")])]),t._v(" "),s("p",[t._v("通配符只能在开头或结尾，而且只能与一个 . 相邻。")]),t._v(" "),s("p",[s("code",[t._v("www.*.example.org")]),t._v(" 和 "),s("code",[t._v("w*.example.org")]),t._v(" 均无效。可以使用正则表达式匹配这些名称，例如 "),s("code",[t._v("~^www\\..+\\.example\\.org$")]),t._v(" 和 "),s("code",[t._v("~^w.*\\.example\\.org$")])]),t._v(" "),s("p",[t._v("而且 "),s("code",[t._v("*")]),t._v(" 可以匹配多个部分。 名称 "),s("code",[t._v("* .example.org")]),t._v(" 不仅匹配 "),s("code",[t._v("www.example.org")]),t._v("，还匹配 "),s("code",[t._v("www.sub.example.org")])])]),t._v(" "),s("li",[s("p",[t._v("正则表达式，以 "),s("code",[t._v("~")]),t._v(" 开头。")]),t._v(" "),s("p",[t._v("对于正则表达式：Nginx 使用的正则表达式与 Perl 编程语言（PCRE）使用的正则表达式兼容。 要使用正则表达式，且必须以 "),s("code",[t._v("~")]),t._v(" 开头。")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("命名的正则表达式可以捕获变量，然后使用:")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server_name   ~^"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("www"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("?"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("domain"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   /sites/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$domain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("小括号 "),s("code",[t._v("()")]),t._v(" 之间匹配的内容，也可以在后面通过 "),s("code",[t._v("$1")]),t._v(" 来引用，"),s("code",[t._v("$2")]),t._v(" 表示的是前面第二个 "),s("code",[t._v("()")]),t._v(" 里的内容。因此上述内容也可写为：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server_name   ~^"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("www"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(".+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   /sites/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("一个 "),e("code",[this._v("server_name")]),this._v(" 示例：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name api.laragh.top  *.laragh.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("同样，如果多个名称匹配 "),e("code",[this._v("Host")]),this._v(" 头部， Nginx 采用下列顺序选择：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("完整的主机名，如 "),s("code",[t._v("api.laragh.top")]),t._v("。")]),t._v(" "),s("li",[t._v("最长的，且以 "),s("code",[t._v("*")]),t._v(" 开头的通配名，如："),s("code",[t._v("*.laragh.top")]),t._v("。")]),t._v(" "),s("li",[t._v("最长的，且以 "),s("code",[t._v("*")]),t._v(" 结尾的通配名，如："),s("code",[t._v("api.*")]),t._v(" 。")]),t._v(" "),s("li",[t._v("第一个匹配的正则表达式。（按照配置文件中的顺序）")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("即优先级："),e("code",[this._v("api.laragh.top")]),this._v(" > "),e("code",[this._v("*.laragh.top")]),this._v(" > "),e("code",[this._v("api.*")]),this._v(" > 正则。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("如果 "),s("code",[t._v("Host")]),t._v(" 头部不匹配任何一个 "),s("code",[t._v("server_name")]),t._v(" ,Nginx 将请求路由到默认虚拟服务器。默认虚拟服务器是指："),s("code",[t._v("nginx.conf")]),t._v(" 文件中第一个 "),s("code",[t._v("server")]),t._v(" 或者 显式用 "),s("code",[t._v("default_server")]),t._v(" 声明：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" default_server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"配置-location"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-location"}},[this._v("#")]),this._v(" 配置 "),e("code",[this._v("location")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"uri-与-location-参数的匹配"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#uri-与-location-参数的匹配"}},[this._v("#")]),this._v(" "),e("code",[this._v("URI")]),this._v(" 与 "),e("code",[this._v("location")]),this._v(" 参数的匹配")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("当选择好 "),e("code",[this._v("server")]),this._v(" 之后，Nginx 会根据 "),e("code",[this._v("URI")]),this._v("s 选择合适的 "),e("code",[this._v("location")]),this._v(" 来决定代理请求或者返回文件。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("location")]),this._v(" 指令接受两种类型的参数：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("前缀字符串（路径名称）")]),this._v(" "),e("li",[this._v("正则表达式")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("对于前缀字符串参数， "),s("code",[t._v("URI")]),t._v("s 必须严格的以它开头。例如对于 "),s("code",[t._v("/some/path/")]),t._v(" 参数，可以匹配 "),s("code",[t._v("/some/path/document.html")]),t._v(" ，但是不匹配 "),s("code",[t._v("/my-site/some/path")]),t._v("，因为 "),s("code",[t._v("/my-site/some/path")]),t._v(" 不以 "),s("code",[t._v("/some/path/")]),t._v(" 开头。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("location /some/path/ "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("{")]),this._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("..")]),this._v(".\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("}")]),this._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("对于正则表达式，以 "),s("code",[t._v("~")]),t._v(" 开头表示大小写敏感，以 "),s("code",[t._v("~*")]),t._v(" 开头表示大小写不敏感。注意路径中的 "),s("code",[t._v(".")]),t._v("要写成 "),s("code",[t._v("\\.")]),t._v(" 。例如一个匹配以 "),s("code",[t._v(".html")]),t._v(" 或者 "),s("code",[t._v(".htm")]),t._v(" 结尾的 "),s("code",[t._v("URI")]),t._v(" 的 "),s("code",[t._v("location")]),t._v("：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("location ~ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(".html? "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("正则表达式的优先级大于前缀字符串。如果找到匹配的前缀字符串，仍继续搜索正则表达式，但如果前缀字符串以 "),e("code",[this._v("^~")]),this._v(" 开头，则不再检查正则表达式。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("将 "),s("code",[t._v("URI")]),t._v(" 与所有的前缀字符串进行比较。")]),t._v(" "),s("li",[s("code",[t._v("=")]),t._v(" 修饰符表明 "),s("code",[t._v("URI")]),t._v(" 必须与前缀字符串相等（不是开始，而是相等），如果找到，则搜索停止。")]),t._v(" "),s("li",[t._v("如果找到的最长前缀匹配字符串以 "),s("code",[t._v("^~")]),t._v(" 开头，则不再搜索正则表达式是否匹配。")]),t._v(" "),s("li",[t._v("存储匹配的最长前缀字符串。")]),t._v(" "),s("li",[t._v("测试对比 "),s("code",[t._v("URI")]),t._v(" 与正则表达式。")]),t._v(" "),s("li",[t._v("找到第一个匹配的正则表达式后停止。")]),t._v(" "),s("li",[t._v("如果没有正则表达式匹配，使用 4 存储的前缀字符串对应的 "),s("code",[t._v("location")]),t._v("。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("=")]),t._v(" 修饰符拥有最高的优先级。如网站首页访问频繁，我们可以专门定义一个 "),s("code",[t._v("location")]),t._v(" 来减少搜索匹配次数（因为搜索到 "),s("code",[t._v("=")]),t._v(" 修饰的匹配的 "),s("code",[t._v("location")]),t._v(" 将停止搜索），提高速度：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"静态文件和代理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#静态文件和代理"}},[this._v("#")]),this._v(" 静态文件和代理")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    location /images/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root /data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        proxy_pass https://laragh.top"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("root")]),t._v(" 指令定义了静态文件的根目录，并且和 "),s("code",[t._v("URI")]),t._v(" 拼接形成最终的本地文件路径。如请求 "),s("code",[t._v("/images/example.png")]),t._v("，则拼接后返回本地服务器文件 "),s("code",[t._v("/data/images/example.png")]),t._v(" 。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("proxy_pass")]),this._v(" 指令将请求传递到 URL 指向的代理服务器。让后将来自代理服务器的响应转发给客户端。 在上面的示例中，所有不以 "),e("code",[this._v("/images /")]),this._v(" 开头的 "),e("code",[this._v("URI")]),this._v(" 的请求都将传递给代理服务器处理。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      listen "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      server_name search.laragh.top"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              proxy_pass https://www.baidu.com"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"使用变量（variables）"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用变量（variables）"}},[this._v("#")]),this._v(" 使用变量（Variables）")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("你可以使用变量来使 Nginx 在不同的请求下采用不同的处理方式。变量是在运行时计算的，用作指令的参数。 变量由 "),e("code",[this._v("$")]),this._v(" 开头的符号表示。 变量基于 Nginx 的状态定义信息，例如当前处理的请求的属性。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("有很多预定义变量，例如核心的 HTTP 变量，你也可以使用 "),s("code",[t._v("set")]),t._v("，"),s("code",[t._v("map")]),t._v(" 和 "),s("code",[t._v("geo")]),t._v(" 指令定义自定义变量。 大多数变量在运行时计算，并包含与特定请求相关的信息。 例如，"),s("code",[t._v("$remote_addr")]),t._v(" 包含客户端 IP 地址，"),s("code",[t._v("$uri")]),t._v(" 保存当前URI值。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("变量名称")]),t._v(" "),s("th",[t._v("作用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("$uri")])]),t._v(" "),s("td",[t._v("请求中的当前URI(不带请求参数)，它可以通过内部重定向，或者使用index指令进行修改，"),s("code",[t._v("$uri")]),t._v("不包含主机名,如 "),s("code",[t._v("/foo/bar.html")]),t._v("。")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("$arg_name")])]),t._v(" "),s("td",[t._v("请求中的的参数名，即“?”后面的"),s("code",[t._v("arg_name=arg_value")]),t._v("形式的"),s("code",[t._v("arg_name")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("$hostname")])]),t._v(" "),s("td",[t._v("主机名")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("$args")])]),t._v(" "),s("td",[t._v("请求中的参数值")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("$query_string")])]),t._v(" "),s("td",[t._v("同 "),s("code",[t._v("$args")])])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("$request")])]),t._v(" "),s("td",[t._v("代表客户端的请求地址")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v("$request_uri")])]),t._v(" "),s("td",[t._v("这个变量等于包含一些客户端请求参数的原始URI，它无法修改，不包含主机名，如："),s("code",[t._v("/cnphp/test.php?arg=freemouse")]),t._v("。")])]),t._v(" "),s("tr",[s("td",[t._v("...")]),t._v(" "),s("td",[t._v("...")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("一个简单的应用就是从 "),e("code",[this._v("http")]),this._v(" 重定向到 "),e("code",[this._v("https")]),this._v(" 时带上路径信息：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n       "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" https://laragh.top"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_uri")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"返回特定状态码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#返回特定状态码"}},[this._v("#")]),this._v(" 返回特定状态码")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果你的网站上的一些资源永久移除了，最快最简洁的方法就是使用 "),e("code",[this._v("return")]),this._v(" 指令直接返回：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("location /wrong/url "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("return")]),this._v(" 的第一个参数是响应代码。可选的第二个参数可以是重定向（对应于代码301，302，303和307）的 URL 或在响应正文中返回的文本。 例如：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("location /permanently/moved/url "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" http://www.example.com/moved/here"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("return")]),this._v(" 指令可以包含在 "),e("code",[this._v("location")]),this._v(" 和 "),e("code",[this._v("server")]),this._v(" 上下文中：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n      "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      location / "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".            \n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"错误处理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#错误处理"}},[this._v("#")]),this._v(" 错误处理")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("error_page")]),this._v(" 命令可以配置特定错误码的错误页面，或者重定向到其他的页面。下面的示例将在 404 错误发生时返回 "),e("code",[this._v("/404.html")]),this._v(" 页面。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[this._v("error_page "),e("span",{pre:!0,attrs:{class:"token number"}},[this._v("404")]),this._v(" /404.html"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v(";")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("error_page")]),this._v(" 命令定义了如何处理错误，因此不会直接返回，而 "),e("code",[this._v("return")]),this._v(" 确实会立即返回。当代理服务器或者 Nginx 处理时产生相应的错误的代码，均会返回相应的错误页面。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在下面的示例中，当 Nginx 找不到页面时，它将使用代码301替换代码404，并将客户端重定向到 "),e("code",[this._v("http://example.com/new/path.html")]),this._v(" 。 此配置很有用，比如当客户端仍尝试用旧的 "),e("code",[this._v("URI")]),this._v(" 访问页面时，301代码通知浏览器页面已永久移除，并且需要自动替换为返回的新地址。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("location /old/path.html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    error_page "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("301")]),t._v(" http:/example.com/new/path.html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"重写-uris"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重写-uris"}},[this._v("#")]),this._v(" 重写 "),e("code",[this._v("URI")]),this._v("s")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("rewrite")]),t._v(" 指令可以多次修改请求的 "),s("code",[t._v("URI")]),t._v("。"),s("code",[t._v("rewrite")]),t._v(" 的第一个参数是 "),s("code",[t._v("URI")]),t._v("需要匹配的正则表达式，第二个参数是将要替换的 "),s("code",[t._v("URI")]),t._v("。第三个参数可选，指示是否继续可以重写或者返回重定向代码（301或302）。例如：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("location /users/ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rewrite ^/users/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(".*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ /show?user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("您可以在 "),s("code",[t._v("server")]),t._v(" 和 "),s("code",[t._v("location")]),t._v(" 上下文中包括多个 "),s("code",[t._v("rewrite")]),t._v(" 指令。 "),s("code",[t._v("Nginx")]),t._v(" 按照它们发生的顺序一个一个地执行指令。 当选择 "),s("code",[t._v("server")]),t._v(" 时，"),s("code",[t._v("server")]),t._v(" 中的 "),s("code",[t._v("rewrite")]),t._v(" 指令将执行一次。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("在 "),s("code",[t._v("Nginx")]),t._v(" 处理一组 "),s("code",[t._v("rewrite")]),t._v(" 指令之后，它根据新的 "),s("code",[t._v("URI")]),t._v(" 选择 "),s("code",[t._v("location")]),t._v(" 。 如果所选 "),s("code",[t._v("location")]),t._v(" 仍旧包含 "),s("code",[t._v("rewrite")]),t._v(" 指令，它们将依次执行。 如果 "),s("code",[t._v("URI")]),t._v(" 匹配所有，则在处理完所有定义的 "),s("code",[t._v("rewrite")]),t._v(" 指令后，搜索新的 "),s("code",[t._v("location")]),t._v(" 。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("以下示例将 "),e("code",[this._v("rewrite")]),this._v(" 指令与 "),e("code",[this._v("return")]),this._v(" 指令结合使用：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("server "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n    rewrite ^"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/download/.*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("/media/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(".*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("*$ "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v("/mp3/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v(".mp3 last"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    rewrite ^"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/download/.*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("/audio/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(".*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("*$ "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v("/mp3/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v(".ra  last"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("return")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("403")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("诸如 "),s("code",[t._v("/download/some/media/file")]),t._v(" 的 URI 被改为 "),s("code",[t._v("/download/some/mp3/file.mp3")]),t._v(" 。 由于 "),s("code",[t._v("last")]),t._v(" 标志，后续指令（第二个 "),s("code",[t._v("rewrite")]),t._v(" 指令和 "),s("code",[t._v("return")]),t._v(" 指令）被跳过，但 Nginx 继续以更改后的 URI 处理请求。 类似地，诸如 "),s("code",[t._v("/download/some/audio/file")]),t._v(" 的 URI 被替换为 "),s("code",[t._v("/download/some/mp3/file.ra")]),t._v("。 如果 URI 不匹配 "),s("code",[t._v("rewrite")]),t._v(" 指令，Nginx 将403 错误代码返回给客户端。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("last")]),this._v(" 与 "),e("code",[this._v("break")]),this._v("的区别是：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("last")]),t._v(" ： 在当前 "),s("code",[t._v("server")]),t._v(" 或 "),s("code",[t._v("location")]),t._v(" 上下文中停止执行 "),s("code",[t._v("rewrite")]),t._v(" 指令，但是 Nginx 继续搜索与重写的URI匹配的 "),s("code",[t._v("location")]),t._v("，并应用新 "),s("code",[t._v("location")]),t._v(" 中的任何 "),s("code",[t._v("rewrite")]),t._v(" 指令（这意味着 URI 可能再次改变）。")]),t._v(" "),s("li",[s("code",[t._v("break")]),t._v(" ：停止当前上下文中 "),s("code",[t._v("rewrite")]),t._v(" 指令的处理，并取消搜索与新 URI 匹配的 "),s("code",[t._v("location")]),t._v("。 不会执行新 "),s("code",[t._v("location")]),t._v("中的 "),s("code",[t._v("rewrite")]),t._v(" 指令。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"附录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#附录"}},[this._v("#")]),this._v(" 附录")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"常用正则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用正则"}},[this._v("#")]),this._v(" 常用正则")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v(".")]),t._v(" ： 匹配除换行符以外的任意字符")]),t._v(" "),s("li",[s("code",[t._v("?")]),t._v(" ： 重复0次或1次")]),t._v(" "),s("li",[s("code",[t._v("+")]),t._v(" ： 重复1次或更多次")]),t._v(" "),s("li",[s("code",[t._v("*")]),t._v("： 重复0次或更多次")]),t._v(" "),s("li",[s("code",[t._v("\\d")]),t._v(" ：匹配数字")]),t._v(" "),s("li",[s("code",[t._v("^")]),t._v(" ： 匹配字符串的开始")]),t._v(" "),s("li",[s("code",[t._v("$")]),t._v(" ： 匹配字符串的结束")]),t._v(" "),s("li",[s("code",[t._v("{n}")]),t._v(" ： 重复n次")]),t._v(" "),s("li",[s("code",[t._v("{n,}")]),t._v(" ： 重复n次或更多次")]),t._v(" "),s("li",[s("code",[t._v("[c]")]),t._v(" ： 匹配单个字符c")]),t._v(" "),s("li",[s("code",[t._v("[a-z]")]),t._v("： 匹配a-z小写字母的任意一个")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"全局变量"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#全局变量"}},[this._v("#")]),this._v(" 全局变量")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("$args")]),t._v(" ： #这个变量等于请求行中的参数，同"),s("code",[t._v("$query_string")])]),t._v(" "),s("li",[s("code",[t._v("$content_length")]),t._v(" ： 请求头中的Content-length字段。")]),t._v(" "),s("li",[s("code",[t._v("$content_type")]),t._v(" ： 请求头中的Content-Type字段。")]),t._v(" "),s("li",[s("code",[t._v("$document_root")]),t._v(" ： 当前请求在root指令中指定的值。")]),t._v(" "),s("li",[s("code",[t._v("$host")]),t._v(" ： 请求主机头字段，否则为服务器名称。")]),t._v(" "),s("li",[s("code",[t._v("$http_user_agent")]),t._v(" ： 客户端agent信息")]),t._v(" "),s("li",[s("code",[t._v("$http_cookie")]),t._v(" ： 客户端cookie信息")]),t._v(" "),s("li",[s("code",[t._v("$limit_rate")]),t._v(" ： 这个变量可以限制连接速率。")]),t._v(" "),s("li",[s("code",[t._v("$request_method")]),t._v(" ： 客户端请求的动作，通常为GET或POST。")]),t._v(" "),s("li",[s("code",[t._v("$remote_addr")]),t._v(" ： 客户端的IP地址。")]),t._v(" "),s("li",[s("code",[t._v("$remote_port")]),t._v(" ： 客户端的端口。")]),t._v(" "),s("li",[s("code",[t._v("$remote_user")]),t._v(" ： 已经经过Auth Basic Module验证的用户名。")]),t._v(" "),s("li",[s("code",[t._v("$request_filename")]),t._v(" ： 当前请求的文件路径，由root或alias指令与URI请求生成。")]),t._v(" "),s("li",[s("code",[t._v("$scheme")]),t._v(" ： HTTP方法（如http，https）。")]),t._v(" "),s("li",[s("code",[t._v("$server_protocol")]),t._v(" ： 请求使用的协议，通常是HTTP/1.0或HTTP/1.1。")]),t._v(" "),s("li",[s("code",[t._v("$server_addr")]),t._v(" ： 服务器地址，在完成一次系统调用后可以确定这个值。")]),t._v(" "),s("li",[s("code",[t._v("$server_name")]),t._v(" ： 服务器名称。")]),t._v(" "),s("li",[s("code",[t._v("$server_port")]),t._v(" ： 请求到达服务器的端口号。")]),t._v(" "),s("li",[s("code",[t._v("$request_uri")]),t._v(" ： 包含请求参数的原始URI，不包含主机名，如："),s("code",[t._v("/foo/bar.php?arg=baz")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("$uri")]),t._v(" ： 不带请求参数的当前URI，$uri不包含主机名，如"),s("code",[t._v("/foo/bar.html")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("$document_uri")]),t._v(" ： 与$uri相同。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("http://localhost:88/test1/test2/test.php")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("$host")]),this._v("："),e("code",[this._v("localhost")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("$server_port")]),this._v("：88")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("$request_uri")]),this._v("："),e("code",[this._v("/test1/test2/test.php")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("$document_uri")]),this._v("："),e("code",[this._v("/test1/test2/test.php")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("$document_root")]),this._v("："),e("code",[this._v("/var/www/html")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("$request_filename")]),this._v("："),e("code",[this._v("/var/www/html/test1/test2/test.php")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[this._v("#")]),this._v(" 参考")])}],!1,null,null,null);e.default=n.exports}}]);